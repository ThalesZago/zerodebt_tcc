/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingOverride,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, Input, EventEmitter, Output, ViewChild } from '@angular/core';
import { FormBuilder } from '@angular/forms';
import { A, Z, ZERO, NINE, SPACE, } from '@angular/cdk/keycodes';
var MatSelectFilterComponent = /** @class */ (function () {
    function MatSelectFilterComponent(fb) {
        this.showSpinner = true;
        this.noResultsMessage = 'No results';
        this.noResults = false;
        this.localSpinner = false;
        this.filteredReturn = new EventEmitter();
        this.filteredItems = [];
        this.searchForm = fb.group({
            value: ''
        });
    }
    /**
     * @return {?}
     */
    MatSelectFilterComponent.prototype.ngOnInit = /**
     * @return {?}
     */
    function () {
        var _this = this;
        this.searchForm.valueChanges.subscribe((/**
         * @param {?} value
         * @return {?}
         */
        function (value) {
            if (_this.showSpinner) {
                _this.localSpinner = true;
            }
            if (value['value']) {
                // IF THE DISPLAY MEMBER INPUT IS SET WE CHECK THE SPECIFIC PROPERTY
                if (_this.displayMember == null) {
                    _this.filteredItems = _this.array.filter((/**
                     * @param {?} name
                     * @return {?}
                     */
                    function (name) { return name.toLowerCase().includes(value['value'].toLowerCase()); }));
                    // OTHERWISE, WE CHECK THE ENTIRE STRING
                }
                else if (_this.hasGroup && _this.groupArrayName && _this.displayMember) {
                    _this.filteredItems = _this.array.map((/**
                     * @param {?} a
                     * @return {?}
                     */
                    function (a) {
                        /** @type {?} */
                        var objCopy = Object.assign({}, a);
                        objCopy[_this.groupArrayName] = objCopy[_this.groupArrayName].filter((/**
                         * @param {?} g
                         * @return {?}
                         */
                        function (g) { return g[_this.displayMember].toLowerCase().includes(value['value'].toLowerCase()); }));
                        return objCopy;
                    })).filter((/**
                     * @param {?} x
                     * @return {?}
                     */
                    function (x) { return x[_this.groupArrayName].length > 0; }));
                }
                else {
                    _this.filteredItems = _this.array.filter((/**
                     * @param {?} name
                     * @return {?}
                     */
                    function (name) { return name[_this.displayMember].toLowerCase().includes(value['value'].toLowerCase()); }));
                }
                // NO RESULTS VALIDATION
                _this.noResults = _this.filteredItems == null || _this.filteredItems.length === 0;
            }
            else {
                _this.filteredItems = _this.array.slice();
                _this.noResults = false;
            }
            _this.filteredReturn.emit(_this.filteredItems);
            setTimeout((/**
             * @return {?}
             */
            function () {
                if (_this.showSpinner) {
                    _this.localSpinner = false;
                }
            }), 2000);
        }));
        setTimeout((/**
         * @return {?}
         */
        function () {
            _this.input.nativeElement.focus();
        }), 500);
        if (!this.placeholder) {
            this.placeholder = 'Search...';
        }
    };
    /**
     * @param {?} event
     * @return {?}
     */
    MatSelectFilterComponent.prototype.handleKeydown = /**
     * @param {?} event
     * @return {?}
     */
    function (event) {
        // PREVENT PROPAGATION FOR ALL ALPHANUMERIC CHARACTERS IN ORDER TO AVOID SELECTION ISSUES
        if ((event.key && event.key.length === 1) ||
            (event.keyCode >= A && event.keyCode <= Z) ||
            (event.keyCode >= ZERO && event.keyCode <= NINE) ||
            (event.keyCode === SPACE)) {
            event.stopPropagation();
        }
    };
    /**
     * @return {?}
     */
    MatSelectFilterComponent.prototype.ngOnDestroy = /**
     * @return {?}
     */
    function () {
        this.filteredReturn.emit(this.array);
    };
    MatSelectFilterComponent.decorators = [
        { type: Component, args: [{
                    selector: 'mat-select-filter',
                    template: "\n  <form [formGroup]=\"searchForm\" class=\"mat-filter\" [ngStyle]=\"{'background-color': color ? color : 'white'}\">\n  <div>\n  <input #input class=\"mat-filter-input\" matInput placeholder=\"{{placeholder}}\" formControlName=\"value\" (keydown)=\"handleKeydown($event)\">\n    <mat-spinner *ngIf=\"localSpinner\" class=\"spinner\" diameter=\"16\"></mat-spinner>\n  </div>\n  <div *ngIf=\"noResults\"\n     class=\"noResultsMessage\">\n  {{noResultsMessage}}\n</div>\n</form>\n  ",
                    styles: [".mat-filter{position:-webkit-sticky;position:sticky;top:0;z-index:100;font-size:inherit;box-shadow:none;border-radius:0;padding:16px;box-sizing:border-box;border-bottom:1px solid grey}.mat-filter-input{-webkit-appearance:none;-moz-appearance:none;appearance:none;outline:0;border:0;background-color:unset;color:gray;width:100%}.spinner{position:absolute;right:16px;top:calc(50% - 8px)}.noResultsMessage{margin-top:10px;font-family:Roboto,\"Helvetica Neue\",sans-serif;font-size:16px}"]
                }] }
    ];
    /** @nocollapse */
    MatSelectFilterComponent.ctorParameters = function () { return [
        { type: FormBuilder }
    ]; };
    MatSelectFilterComponent.propDecorators = {
        input: [{ type: ViewChild, args: ['input', { static: true },] }],
        array: [{ type: Input, args: ['array',] }],
        placeholder: [{ type: Input, args: ['placeholder',] }],
        color: [{ type: Input, args: ['color',] }],
        displayMember: [{ type: Input, args: ['displayMember',] }],
        showSpinner: [{ type: Input, args: ['showSpinner',] }],
        noResultsMessage: [{ type: Input, args: ['noResultsMessage',] }],
        hasGroup: [{ type: Input, args: ['hasGroup',] }],
        groupArrayName: [{ type: Input, args: ['groupArrayName',] }],
        filteredReturn: [{ type: Output }]
    };
    return MatSelectFilterComponent;
}());
export { MatSelectFilterComponent };
if (false) {
    /** @type {?} */
    MatSelectFilterComponent.prototype.input;
    /** @type {?} */
    MatSelectFilterComponent.prototype.array;
    /** @type {?} */
    MatSelectFilterComponent.prototype.placeholder;
    /** @type {?} */
    MatSelectFilterComponent.prototype.color;
    /** @type {?} */
    MatSelectFilterComponent.prototype.displayMember;
    /** @type {?} */
    MatSelectFilterComponent.prototype.showSpinner;
    /** @type {?} */
    MatSelectFilterComponent.prototype.noResultsMessage;
    /** @type {?} */
    MatSelectFilterComponent.prototype.hasGroup;
    /** @type {?} */
    MatSelectFilterComponent.prototype.groupArrayName;
    /** @type {?} */
    MatSelectFilterComponent.prototype.noResults;
    /** @type {?} */
    MatSelectFilterComponent.prototype.localSpinner;
    /** @type {?} */
    MatSelectFilterComponent.prototype.filteredReturn;
    /** @type {?} */
    MatSelectFilterComponent.prototype.filteredItems;
    /** @type {?} */
    MatSelectFilterComponent.prototype.searchForm;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWF0LXNlbGVjdC1maWx0ZXIuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6Im5nOi8vbWF0LXNlbGVjdC1maWx0ZXIvIiwic291cmNlcyI6WyJsaWIvbWF0LXNlbGVjdC1maWx0ZXIuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7QUFBQSxPQUFPLEVBQUUsU0FBUyxFQUFVLEtBQUssRUFBRSxZQUFZLEVBQUUsTUFBTSxFQUFFLFNBQVMsRUFBYSxNQUFNLGVBQWUsQ0FBQztBQUNyRyxPQUFPLEVBQWEsV0FBVyxFQUFFLE1BQU0sZ0JBQWdCLENBQUM7QUFDeEQsT0FBTyxFQUNMLENBQUMsRUFDRCxDQUFDLEVBQ0QsSUFBSSxFQUNKLElBQUksRUFDSixLQUFLLEdBQ04sTUFBTSx1QkFBdUIsQ0FBQztBQUMvQjtJQW9DRSxrQ0FBWSxFQUFlO1FBYkwsZ0JBQVcsR0FBRyxJQUFJLENBQUM7UUFDZCxxQkFBZ0IsR0FBRyxZQUFZLENBQUM7UUFJM0QsY0FBUyxHQUFHLEtBQUssQ0FBQztRQUVsQixpQkFBWSxHQUFHLEtBQUssQ0FBQztRQUNYLG1CQUFjLEdBQUcsSUFBSSxZQUFZLEVBQU8sQ0FBQztRQUU1QyxrQkFBYSxHQUFRLEVBQUUsQ0FBQztRQUk3QixJQUFJLENBQUMsVUFBVSxHQUFHLEVBQUUsQ0FBQyxLQUFLLENBQUM7WUFDekIsS0FBSyxFQUFFLEVBQUU7U0FDVixDQUFDLENBQUM7SUFDTCxDQUFDOzs7O0lBRUQsMkNBQVE7OztJQUFSO1FBQUEsaUJBMENDO1FBekNDLElBQUksQ0FBQyxVQUFVLENBQUMsWUFBWSxDQUFDLFNBQVM7Ozs7UUFBQyxVQUFBLEtBQUs7WUFDMUMsSUFBSSxLQUFJLENBQUMsV0FBVyxFQUFFO2dCQUNwQixLQUFJLENBQUMsWUFBWSxHQUFHLElBQUksQ0FBQzthQUMxQjtZQUNELElBQUksS0FBSyxDQUFDLE9BQU8sQ0FBQyxFQUFFO2dCQUNsQixvRUFBb0U7Z0JBQ3BFLElBQUksS0FBSSxDQUFDLGFBQWEsSUFBSSxJQUFJLEVBQUU7b0JBQzlCLEtBQUksQ0FBQyxhQUFhLEdBQUcsS0FBSSxDQUFDLEtBQUssQ0FBQyxNQUFNOzs7O29CQUFDLFVBQUEsSUFBSSxJQUFJLE9BQUEsSUFBSSxDQUFDLFdBQVcsRUFBRSxDQUFDLFFBQVEsQ0FBQyxLQUFLLENBQUMsT0FBTyxDQUFDLENBQUMsV0FBVyxFQUFFLENBQUMsRUFBekQsQ0FBeUQsRUFBQyxDQUFDO29CQUMxRyx3Q0FBd0M7aUJBQ3pDO3FCQUFNLElBQUksS0FBSSxDQUFDLFFBQVEsSUFBSSxLQUFJLENBQUMsY0FBYyxJQUFJLEtBQUksQ0FBQyxhQUFhLEVBQUU7b0JBQ3JFLEtBQUksQ0FBQyxhQUFhLEdBQUcsS0FBSSxDQUFDLEtBQUssQ0FBQyxHQUFHOzs7O29CQUFDLFVBQUEsQ0FBQzs7NEJBQzdCLE9BQU8sR0FBRyxNQUFNLENBQUMsTUFBTSxDQUFDLEVBQUUsRUFBRSxDQUFDLENBQUM7d0JBQ3BDLE9BQU8sQ0FBQyxLQUFJLENBQUMsY0FBYyxDQUFDLEdBQUcsT0FBTyxDQUFDLEtBQUksQ0FBQyxjQUFjLENBQUMsQ0FBQyxNQUFNOzs7O3dCQUFDLFVBQUEsQ0FBQyxJQUFJLE9BQUEsQ0FBQyxDQUFDLEtBQUksQ0FBQyxhQUFhLENBQUMsQ0FBQyxXQUFXLEVBQUUsQ0FBQyxRQUFRLENBQUMsS0FBSyxDQUFDLE9BQU8sQ0FBQyxDQUFDLFdBQVcsRUFBRSxDQUFDLEVBQTFFLENBQTBFLEVBQUMsQ0FBQzt3QkFDcEosT0FBTyxPQUFPLENBQUM7b0JBQ2pCLENBQUMsRUFBQyxDQUFDLE1BQU07Ozs7b0JBQUMsVUFBQSxDQUFDLElBQUksT0FBQSxDQUFDLENBQUMsS0FBSSxDQUFDLGNBQWMsQ0FBQyxDQUFDLE1BQU0sR0FBRyxDQUFDLEVBQWpDLENBQWlDLEVBQUMsQ0FBQztpQkFDbkQ7cUJBQU07b0JBQ0wsS0FBSSxDQUFDLGFBQWEsR0FBRyxLQUFJLENBQUMsS0FBSyxDQUFDLE1BQU07Ozs7b0JBQUMsVUFBQSxJQUFJLElBQUksT0FBQSxJQUFJLENBQUMsS0FBSSxDQUFDLGFBQWEsQ0FBQyxDQUFDLFdBQVcsRUFBRSxDQUFDLFFBQVEsQ0FBQyxLQUFLLENBQUMsT0FBTyxDQUFDLENBQUMsV0FBVyxFQUFFLENBQUMsRUFBN0UsQ0FBNkUsRUFBQyxDQUFDO2lCQUMvSDtnQkFDRCx3QkFBd0I7Z0JBRXhCLEtBQUksQ0FBQyxTQUFTLEdBQUcsS0FBSSxDQUFDLGFBQWEsSUFBSSxJQUFJLElBQUksS0FBSSxDQUFDLGFBQWEsQ0FBQyxNQUFNLEtBQUssQ0FBQyxDQUFDO2FBR2hGO2lCQUFNO2dCQUNMLEtBQUksQ0FBQyxhQUFhLEdBQUcsS0FBSSxDQUFDLEtBQUssQ0FBQyxLQUFLLEVBQUUsQ0FBQztnQkFDeEMsS0FBSSxDQUFDLFNBQVMsR0FBRyxLQUFLLENBQUM7YUFDeEI7WUFDRCxLQUFJLENBQUMsY0FBYyxDQUFDLElBQUksQ0FBQyxLQUFJLENBQUMsYUFBYSxDQUFDLENBQUM7WUFDN0MsVUFBVTs7O1lBQUM7Z0JBQ1QsSUFBSSxLQUFJLENBQUMsV0FBVyxFQUFFO29CQUNwQixLQUFJLENBQUMsWUFBWSxHQUFHLEtBQUssQ0FBQztpQkFDM0I7WUFDSCxDQUFDLEdBQUUsSUFBSSxDQUFDLENBQUM7UUFDWCxDQUFDLEVBQUMsQ0FBQztRQUVILFVBQVU7OztRQUFDO1lBQ1QsS0FBSSxDQUFDLEtBQUssQ0FBQyxhQUFhLENBQUMsS0FBSyxFQUFFLENBQUM7UUFDbkMsQ0FBQyxHQUFFLEdBQUcsQ0FBQyxDQUFDO1FBQ1IsSUFBSSxDQUFDLElBQUksQ0FBQyxXQUFXLEVBQUU7WUFDckIsSUFBSSxDQUFDLFdBQVcsR0FBRyxXQUFXLENBQUM7U0FDaEM7SUFDSCxDQUFDOzs7OztJQUVELGdEQUFhOzs7O0lBQWIsVUFBYyxLQUFvQjtRQUNoQyx5RkFBeUY7UUFDekYsSUFBSSxDQUFDLEtBQUssQ0FBQyxHQUFHLElBQUksS0FBSyxDQUFDLEdBQUcsQ0FBQyxNQUFNLEtBQUssQ0FBQyxDQUFDO1lBQ3ZDLENBQUMsS0FBSyxDQUFDLE9BQU8sSUFBSSxDQUFDLElBQUksS0FBSyxDQUFDLE9BQU8sSUFBSSxDQUFDLENBQUM7WUFDMUMsQ0FBQyxLQUFLLENBQUMsT0FBTyxJQUFJLElBQUksSUFBSSxLQUFLLENBQUMsT0FBTyxJQUFJLElBQUksQ0FBQztZQUNoRCxDQUFDLEtBQUssQ0FBQyxPQUFPLEtBQUssS0FBSyxDQUFDLEVBQUU7WUFDM0IsS0FBSyxDQUFDLGVBQWUsRUFBRSxDQUFDO1NBQ3pCO0lBQ0gsQ0FBQzs7OztJQUNELDhDQUFXOzs7SUFBWDtRQUNFLElBQUksQ0FBQyxjQUFjLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQztJQUN2QyxDQUFDOztnQkFqR0YsU0FBUyxTQUFDO29CQUNULFFBQVEsRUFBRSxtQkFBbUI7b0JBQzdCLFFBQVEsRUFBRSxvZUFXVDs7aUJBRUY7Ozs7Z0JBdkJtQixXQUFXOzs7d0JBeUI1QixTQUFTLFNBQUMsT0FBTyxFQUFFLEVBQUUsTUFBTSxFQUFFLElBQUksRUFBRTt3QkFFbkMsS0FBSyxTQUFDLE9BQU87OEJBQ2IsS0FBSyxTQUFDLGFBQWE7d0JBQ25CLEtBQUssU0FBQyxPQUFPO2dDQUNiLEtBQUssU0FBQyxlQUFlOzhCQUNyQixLQUFLLFNBQUMsYUFBYTttQ0FDbkIsS0FBSyxTQUFDLGtCQUFrQjsyQkFDeEIsS0FBSyxTQUFDLFVBQVU7aUNBQ2hCLEtBQUssU0FBQyxnQkFBZ0I7aUNBS3RCLE1BQU07O0lBbUVULCtCQUFDO0NBQUEsQUFsR0QsSUFrR0M7U0FsRlksd0JBQXdCOzs7SUFDbkMseUNBQTRDOztJQUU1Qyx5Q0FBMkI7O0lBQzNCLCtDQUEwQzs7SUFDMUMseUNBQThCOztJQUM5QixpREFBOEM7O0lBQzlDLCtDQUF5Qzs7SUFDekMsb0RBQTJEOztJQUMzRCw0Q0FBcUM7O0lBQ3JDLGtEQUFnRDs7SUFFaEQsNkNBQWtCOztJQUVsQixnREFBcUI7O0lBQ3JCLGtEQUFtRDs7SUFFbkQsaURBQStCOztJQUMvQiw4Q0FBNkIiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDb21wb25lbnQsIE9uSW5pdCwgSW5wdXQsIEV2ZW50RW1pdHRlciwgT3V0cHV0LCBWaWV3Q2hpbGQsIE9uRGVzdHJveSB9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgRm9ybUdyb3VwLCBGb3JtQnVpbGRlciB9IGZyb20gJ0Bhbmd1bGFyL2Zvcm1zJztcbmltcG9ydCB7XG4gIEEsXG4gIFosXG4gIFpFUk8sXG4gIE5JTkUsXG4gIFNQQUNFLCBFTkQsIEhPTUUsXG59IGZyb20gJ0Bhbmd1bGFyL2Nkay9rZXljb2Rlcyc7XG5AQ29tcG9uZW50KHtcbiAgc2VsZWN0b3I6ICdtYXQtc2VsZWN0LWZpbHRlcicsXG4gIHRlbXBsYXRlOiBgXG4gIDxmb3JtIFtmb3JtR3JvdXBdPVwic2VhcmNoRm9ybVwiIGNsYXNzPVwibWF0LWZpbHRlclwiIFtuZ1N0eWxlXT1cInsnYmFja2dyb3VuZC1jb2xvcic6IGNvbG9yID8gY29sb3IgOiAnd2hpdGUnfVwiPlxuICA8ZGl2PlxuICA8aW5wdXQgI2lucHV0IGNsYXNzPVwibWF0LWZpbHRlci1pbnB1dFwiIG1hdElucHV0IHBsYWNlaG9sZGVyPVwie3twbGFjZWhvbGRlcn19XCIgZm9ybUNvbnRyb2xOYW1lPVwidmFsdWVcIiAoa2V5ZG93bik9XCJoYW5kbGVLZXlkb3duKCRldmVudClcIj5cbiAgICA8bWF0LXNwaW5uZXIgKm5nSWY9XCJsb2NhbFNwaW5uZXJcIiBjbGFzcz1cInNwaW5uZXJcIiBkaWFtZXRlcj1cIjE2XCI+PC9tYXQtc3Bpbm5lcj5cbiAgPC9kaXY+XG4gIDxkaXYgKm5nSWY9XCJub1Jlc3VsdHNcIlxuICAgICBjbGFzcz1cIm5vUmVzdWx0c01lc3NhZ2VcIj5cbiAge3tub1Jlc3VsdHNNZXNzYWdlfX1cbjwvZGl2PlxuPC9mb3JtPlxuICBgLFxuICBzdHlsZVVybHM6IFsnLi9tYXQtc2VsZWN0LWZpbHRlci5jb21wb25lbnQuc2NzcyddXG59KVxuZXhwb3J0IGNsYXNzIE1hdFNlbGVjdEZpbHRlckNvbXBvbmVudCBpbXBsZW1lbnRzIE9uSW5pdCwgT25EZXN0cm95IHtcbiAgQFZpZXdDaGlsZCgnaW5wdXQnLCB7IHN0YXRpYzogdHJ1ZSB9KSBpbnB1dDtcblxuICBASW5wdXQoJ2FycmF5JykgYXJyYXk6IGFueTtcbiAgQElucHV0KCdwbGFjZWhvbGRlcicpIHBsYWNlaG9sZGVyOiBzdHJpbmc7XG4gIEBJbnB1dCgnY29sb3InKSBjb2xvcjogc3RyaW5nO1xuICBASW5wdXQoJ2Rpc3BsYXlNZW1iZXInKSBkaXNwbGF5TWVtYmVyOiBzdHJpbmc7XG4gIEBJbnB1dCgnc2hvd1NwaW5uZXInKSBzaG93U3Bpbm5lciA9IHRydWU7XG4gIEBJbnB1dCgnbm9SZXN1bHRzTWVzc2FnZScpIG5vUmVzdWx0c01lc3NhZ2UgPSAnTm8gcmVzdWx0cyc7XG4gIEBJbnB1dCgnaGFzR3JvdXAnKSBoYXNHcm91cDogYm9vbGVhbjtcbiAgQElucHV0KCdncm91cEFycmF5TmFtZScpIGdyb3VwQXJyYXlOYW1lOiBzdHJpbmc7XG5cbiAgbm9SZXN1bHRzID0gZmFsc2U7XG5cbiAgbG9jYWxTcGlubmVyID0gZmFsc2U7XG4gIEBPdXRwdXQoKSBmaWx0ZXJlZFJldHVybiA9IG5ldyBFdmVudEVtaXR0ZXI8YW55PigpO1xuXG4gIHB1YmxpYyBmaWx0ZXJlZEl0ZW1zOiBhbnkgPSBbXTtcbiAgcHVibGljIHNlYXJjaEZvcm06IEZvcm1Hcm91cDtcblxuICBjb25zdHJ1Y3RvcihmYjogRm9ybUJ1aWxkZXIpIHtcbiAgICB0aGlzLnNlYXJjaEZvcm0gPSBmYi5ncm91cCh7XG4gICAgICB2YWx1ZTogJydcbiAgICB9KTtcbiAgfVxuXG4gIG5nT25Jbml0KCkge1xuICAgIHRoaXMuc2VhcmNoRm9ybS52YWx1ZUNoYW5nZXMuc3Vic2NyaWJlKHZhbHVlID0+IHtcbiAgICAgIGlmICh0aGlzLnNob3dTcGlubmVyKSB7XG4gICAgICAgIHRoaXMubG9jYWxTcGlubmVyID0gdHJ1ZTtcbiAgICAgIH1cbiAgICAgIGlmICh2YWx1ZVsndmFsdWUnXSkge1xuICAgICAgICAvLyBJRiBUSEUgRElTUExBWSBNRU1CRVIgSU5QVVQgSVMgU0VUIFdFIENIRUNLIFRIRSBTUEVDSUZJQyBQUk9QRVJUWVxuICAgICAgICBpZiAodGhpcy5kaXNwbGF5TWVtYmVyID09IG51bGwpIHtcbiAgICAgICAgICB0aGlzLmZpbHRlcmVkSXRlbXMgPSB0aGlzLmFycmF5LmZpbHRlcihuYW1lID0+IG5hbWUudG9Mb3dlckNhc2UoKS5pbmNsdWRlcyh2YWx1ZVsndmFsdWUnXS50b0xvd2VyQ2FzZSgpKSk7XG4gICAgICAgICAgLy8gT1RIRVJXSVNFLCBXRSBDSEVDSyBUSEUgRU5USVJFIFNUUklOR1xuICAgICAgICB9IGVsc2UgaWYgKHRoaXMuaGFzR3JvdXAgJiYgdGhpcy5ncm91cEFycmF5TmFtZSAmJiB0aGlzLmRpc3BsYXlNZW1iZXIpIHtcbiAgICAgICAgICB0aGlzLmZpbHRlcmVkSXRlbXMgPSB0aGlzLmFycmF5Lm1hcChhID0+IHtcbiAgICAgICAgICAgIGNvbnN0IG9iakNvcHkgPSBPYmplY3QuYXNzaWduKHt9LCBhKTtcbiAgICAgICAgICAgIG9iakNvcHlbdGhpcy5ncm91cEFycmF5TmFtZV0gPSBvYmpDb3B5W3RoaXMuZ3JvdXBBcnJheU5hbWVdLmZpbHRlcihnID0+IGdbdGhpcy5kaXNwbGF5TWVtYmVyXS50b0xvd2VyQ2FzZSgpLmluY2x1ZGVzKHZhbHVlWyd2YWx1ZSddLnRvTG93ZXJDYXNlKCkpKTtcbiAgICAgICAgICAgIHJldHVybiBvYmpDb3B5O1xuICAgICAgICAgIH0pLmZpbHRlcih4ID0+IHhbdGhpcy5ncm91cEFycmF5TmFtZV0ubGVuZ3RoID4gMCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgdGhpcy5maWx0ZXJlZEl0ZW1zID0gdGhpcy5hcnJheS5maWx0ZXIobmFtZSA9PiBuYW1lW3RoaXMuZGlzcGxheU1lbWJlcl0udG9Mb3dlckNhc2UoKS5pbmNsdWRlcyh2YWx1ZVsndmFsdWUnXS50b0xvd2VyQ2FzZSgpKSk7XG4gICAgICAgIH1cbiAgICAgICAgLy8gTk8gUkVTVUxUUyBWQUxJREFUSU9OXG5cbiAgICAgICAgdGhpcy5ub1Jlc3VsdHMgPSB0aGlzLmZpbHRlcmVkSXRlbXMgPT0gbnVsbCB8fCB0aGlzLmZpbHRlcmVkSXRlbXMubGVuZ3RoID09PSAwO1xuXG5cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXMuZmlsdGVyZWRJdGVtcyA9IHRoaXMuYXJyYXkuc2xpY2UoKTtcbiAgICAgICAgdGhpcy5ub1Jlc3VsdHMgPSBmYWxzZTtcbiAgICAgIH1cbiAgICAgIHRoaXMuZmlsdGVyZWRSZXR1cm4uZW1pdCh0aGlzLmZpbHRlcmVkSXRlbXMpO1xuICAgICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICAgIGlmICh0aGlzLnNob3dTcGlubmVyKSB7XG4gICAgICAgICAgdGhpcy5sb2NhbFNwaW5uZXIgPSBmYWxzZTtcbiAgICAgICAgfVxuICAgICAgfSwgMjAwMCk7XG4gICAgfSk7XG5cbiAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgIHRoaXMuaW5wdXQubmF0aXZlRWxlbWVudC5mb2N1cygpO1xuICAgIH0sIDUwMCk7XG4gICAgaWYgKCF0aGlzLnBsYWNlaG9sZGVyKSB7XG4gICAgICB0aGlzLnBsYWNlaG9sZGVyID0gJ1NlYXJjaC4uLic7XG4gICAgfVxuICB9XG5cbiAgaGFuZGxlS2V5ZG93bihldmVudDogS2V5Ym9hcmRFdmVudCkge1xuICAgIC8vIFBSRVZFTlQgUFJPUEFHQVRJT04gRk9SIEFMTCBBTFBIQU5VTUVSSUMgQ0hBUkFDVEVSUyBJTiBPUkRFUiBUTyBBVk9JRCBTRUxFQ1RJT04gSVNTVUVTXG4gICAgaWYgKChldmVudC5rZXkgJiYgZXZlbnQua2V5Lmxlbmd0aCA9PT0gMSkgfHxcbiAgICAgIChldmVudC5rZXlDb2RlID49IEEgJiYgZXZlbnQua2V5Q29kZSA8PSBaKSB8fFxuICAgICAgKGV2ZW50LmtleUNvZGUgPj0gWkVSTyAmJiBldmVudC5rZXlDb2RlIDw9IE5JTkUpIHx8XG4gICAgICAoZXZlbnQua2V5Q29kZSA9PT0gU1BBQ0UpKSB7XG4gICAgICBldmVudC5zdG9wUHJvcGFnYXRpb24oKTtcbiAgICB9XG4gIH1cbiAgbmdPbkRlc3Ryb3koKSB7XG4gICAgdGhpcy5maWx0ZXJlZFJldHVybi5lbWl0KHRoaXMuYXJyYXkpO1xuICB9XG59XG4iXX0=